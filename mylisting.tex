\usepackage{listings}
\usepackage{xcolor}
\usepackage{ifluatex,ifxetex}

\ifxetex \else
	\ifluatex \else
		\usepackage{jlisting}
		% \makeatletter
		% \def\lst@title@dropdelim\hskip1zw{}
		% \makeatother
	\fi
\fi


\definecolor{cream}{HTML}{FFFFCC}
\definecolor{gray}{HTML}{626262}
\definecolor{green}{HTML}{006400}
\definecolor{str}{HTML}{FF1493}
\definecolor{gold}{HTML}{FFA500}
\definecolor{waterblue}{HTML}{4169E1}
\definecolor{text}{HTML}{3CB371}
\definecolor{stdout}{HTML}{DC143C}
\definecolor{yellow}{HTML}{FFAF00}

\lstset{
	float=hbp,
	backgroundcolor=\color{cream},
	basicstyle=\ttfamily\color{green},
	numberstyle=\ttfamily\footnotesize\color{black},
	rulecolor=\color{black},
	identifierstyle=\color{green},
	keywordstyle=\color{waterblue},
	keywordstyle=[2]\color{str},
	keywordstyle=[3]\color{text},
	keywordstyle=[4]\color{gold},
	keywordstyle=[5]\color{stdout},
	stringstyle=\color{str},
	commentstyle=\color{gray},
	columns=flexible,
	tabsize=2,
	frame=single,
	extendedchars=true,
	inputencoding=utf8x,
	showspaces=false,
	showstringspaces=false,
	numbers=left,
	breaklines=true,
	breakautoindent=true,
	captionpos=t,
}
\lstdefinelanguage{MoonScript}{
	keywords={class,when,for,in,while,with,do,import,from,return,and,or,local,not,break,continue,extends},
	keywordstyle=\ttfamily\color{yellow},
	comment=[l]{--},
	keywords=[2]{if,else,elseif,when,switch,then},
	keywordstyle=[2]\ttfamily\color{text},
	morestring=[b]",
	morestring=[b]'
}

\newcommand{\mylisting}[2][]{%
	\bgroup%
	\renewcommand*{\lstlistingname}{\tt\small Code}%
	\lstinputlisting[caption={\tt\small\detokenize{#2}},#1]{#2}%
	\ifluatex%
		\vspace{1\zw}%
		\else%
			\ifxetex%
				\vspace{1em}%
			\else%
			\vspace{1em}%
		\fi%
	\fi%
	\egroup%
}

\lstnewenvironment{result}[2][]{
	\lstset{
		language=,
		numbers=none,
		nolol,
		title={\tt\small #2},
		#1
	}
}{
	\ifluatex
		\vspace{1\zw}
	\else
		\ifxetex
			\vspace{11pt}
		\else
			\vspace{1em}
		\fi
	\fi
}

\ifluatex
\newcommand{\lstinlinef}{\hspace{-0.55\zw}\lstinline}
\fi

